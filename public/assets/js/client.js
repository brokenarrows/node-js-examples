// Generated by CoffeeScript 1.12.4
(function() {
  var client;

  client = function(queue, data) {
    'use strict';
    var http, querystring, request, server;
    request = require('request');
    http = require('http');
    querystring = require('querystring');
    server = http.createServer(function(request, resource) {
      var body;
      body = '';
      request.on('data', function(chunk) {
        body += chunk;
        if (body.length > 1e5) {
          request.connection.destroy();
        }
      });
      request.on('end', function() {
        var result;
        resource.writeHead(200, {
          'Content-Type': 'application/json'
        });
        result = {
          status: 'ok',
          content: querystring.parse(body),
          port: server.address().port
        };
        resource.end(JSON.stringify(result) + '\n');
        if (typeof data === 'function') {
          data(result);
        }
      });
    }).listen(function() {
      request.post('http://localhost' + server.address().port + '/queues/' + queue + '/consumers', {
        form: {
          callback_url: 'http://localhost' + server.address().port
        }
      }, function(error, resource, body) {
        if (error) {
          console.warn('Failed URL request...');
        }
      });
    });
  };

  module.exports = client;

}).call(this);

//# sourceMappingURL=client.js.map
